- alert: PrometheusAllTargetsMissing
  expr: count by (job) (up) == 0
  for: 0m
  labels:
    severity: critical
  annotations:
    summary: Prometheus all targets missing (instance {{ $labels.instance }})
    description: "A Prometheus job does not have living target anymore.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

- alert: PrometheusTooManyRestarts
  expr: changes(process_start_time_seconds{job=~"prometheus|pushgateway|alertmanager"}[15m]) > 2
  for: 0m
  labels:
    severity: warning
  annotations:
    summary: Prometheus too many restarts (instance {{ $labels.instance }})
    description: "Prometheus has restarted more than twice in the last 15 minutes. It might be crashlooping.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

- alert: PrometheusNotConnectedToAlertmanager
  expr: prometheus_notifications_alertmanagers_discovered < 1
  for: 0m
  labels:
    severity: critical
  annotations:
    summary: Prometheus not connected to alertmanager (instance {{ $labels.instance }})
    description: "Prometheus cannot connect the alertmanager\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

- alert: PrometheusTargetScrapingSlow
  expr: prometheus_target_interval_length_seconds{quantile="0.9"} > 60
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: Prometheus target scraping slow (instance {{ $labels.instance }})
    description: "Prometheus is scraping exporters slowly\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
